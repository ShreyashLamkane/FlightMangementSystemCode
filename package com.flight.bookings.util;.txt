package com.flight.bookings.util;

import java.util.ArrayList;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.stereotype.Service;

import com.flight.bookings.entity.Bookings;
import com.flight.bookings.entity.Flight;
import com.flight.bookings.entity.Passengers;
import com.flight.bookings.external.service.FlightService;
import com.flight.bookings.service.BookingsService;
import com.flight.bookings.service.PassengersService;

@Component
public class BookingsUtilImpl implements BookingsService {


	@Autowired
	private BookingsService bookingsService;
	
	@Autowired
	private PassengersService passengersService;
	
	@Autowired
	private FlightService flightService;
	@Override
	public Bookings createBookings(Bookings bookings) {
		// TODO Auto-generated method stub
//		Flight flight=flightService.getFlightById(bookings.getFlightId());
//		bookings.setFlight(flight);
//		bookings.setTotalFare(flight.getFare()*bookings.getNoOfPassengers());
		Bookings r=bookingsService.createBookings(bookings);
		for(Passengers p: bookings.getPassenger()) {
			Passengers passenger=new Passengers();
			passenger.setBookingId(r.getBookingId());
			
			passenger.setFlightId(r.getFlightId());
			passenger.setPassengerName(p.getPassengerName());
			passenger.setPassengerPhone(p.getPassengerPhone());
			passenger.setPassengerEmail(p.getPassengerEmail());
			
			passengersService.createPassengers(passenger);
		}
		Flight flight=flightService.getFlightById(bookings.getFlightId());
		bookings.setFlight(flight);
		bookings.setTotalFare(flight.getFare()*bookings.getNoOfPassengers());
		bookingsService.createBookings(bookings);
		return r;
	}

	@Override
	public void removeById(String bookingId) {
		// TODO Auto-generated method stub
		passengersService.removeByBooking(bookingId);
		bookingsService.removeById(bookingId);
	}

	@Override
	public Bookings getById(String bookingId) {
		// TODO Auto-generated method stub
		ArrayList<Passengers> list=new ArrayList<Passengers>();
		list=passengersService.getByBookingId(bookingId);
		Bookings booked=bookingsService.getById(bookingId);
		booked.setPassenger(list);
		return booked;
	}

}


package com.flight.bookings.util;

import com.flight.bookings.entity.Bookings;

public interface BookingsUtil {
	Bookings createBookings(Bookings bookings) ;
	void  removeById(String bookingId);
	Bookings getById(String bookingId);
}


package com.flight.bookings.util;

import java.util.ArrayList;

import com.flight.bookings.entity.Passengers;

public interface PassengersUtil {
	Passengers createPassengers(Passengers passengers);
	Passengers getPassengersById(String passengerId);
	void removePassenger(String passengerId);
	Passengers updatePassenger(Passengers passenger);
	ArrayList<Passengers> getByBookingId(String bookingId);
	void removeByBooking(String bookingId);
}




package com.flight.bookings.util;

import java.util.ArrayList;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.stereotype.Service;

import com.flight.bookings.entity.Passengers;
import com.flight.bookings.service.PassengersService;

@Component
public class PassengersUtilImpl implements PassengersUtil{
	@Autowired
	private PassengersService passengersService;
	
	@Override
	public Passengers createPassengers(Passengers passengers) {
		// TODO Auto-generated method stub
		return passengersService.createPassengers(passengers);
	}

	@Override
	public Passengers getPassengersById(String passengerId) {
		// TODO Auto-generated method stub
		return passengersService.getPassengersById(passengerId);
	}

	@Override
	public void removePassenger(String passengerId) {
		// TODO Auto-generated method stub
		passengersService.removePassenger(passengerId);
	}

	@Override
	public Passengers updatePassenger(Passengers passenger) {
		// TODO Auto-generated method stub
		return passengersService.updatePassenger(passenger);
	}

	@Override
	public ArrayList<Passengers> getByBookingId(String bookingId) {
		// TODO Auto-generated method stub
		return passengersService.getByBookingId(bookingId);
	}

	@Override
	public void removeByBooking(String bookingId) {
		// TODO Auto-generated method stub
		passengersService.removeByBooking(bookingId);
	}
}
